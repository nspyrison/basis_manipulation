---
title: "spinifex Vignette"
author: "Nicholas Spyrison"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette  #https://github.com/njtierney/naniar/blob/master/vignettes/getting-started-w-naniar.Rmd
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Overview

Datasets commonly contain many (p>3) variables/dimensions. Numeric aggregation and modeling can be adapted and interpolated relatively easily as the number of variables increase. Visualization of model and estimate space (think residual or parallel coordinate plots) are nessicary for the formulation of models. Yet, visuals in data space often fall by the wayside, especially when trying to illustrate more than 3 dimensions. The lack of use of tools for visualizing many dimensions degrades the richness of intution, analysis, and discussion.

The R package tourr [@Cook&Wickham] provides a 



# Example 1 - Rotate Flea data

Suppose we want to perform a rotation on one (or more) dimensions on the projection of a higher dimensional (p>3D) space/data. 

Let: 

- n be number of observations (rows)
- p be number of dimensions/numeric variables (columns)
- d be the number of dimensions in variable space. Each dimension is a linear combinations of the variables. For our purposes each basis will be d=2 (which will go to d=3 to rotate the linear combinations out of plane). 

In order to rotate a dimension in p-space we need the following args: 

- `basis`, a starting basis, an orthonormal linear combination of p-dimensions, 
- `manip_var`, which dimension(s) to rotate,
- `phi`, angle controlling the magnitude of change of `manip var`
- `theta`, the angle of the change of the `manip var`

For a test data set use flea [n=74, p=6]. In order to get to a manipulation space (`manip_space`) use `create_manip_space(basis, manip_var)`. Below, we will generate a random basis [p, d=2] via `basis_random(p)` and arbitrarily let the `manip_var` be 3.

```{r}
#devtools::install_github("nspyrison/spinifex")
library(spinifex)

data <- flea[,1:6]
p <- ncol(data)

this_manip_space <- create_manip_space(basis = basis_random(p = p), manip_var = 3)
```

We then rotate the 3rd variable by an arbitrarily desired magnitude, `phi`, at an arbitrarily desired magnitude, `theta`. The [p, d+1=3] rotated space, (`r_space`) is returned. This is the the linear combination for the xyz contributions in p-space for this rotation.

```{r}
radial_manip(manip_space = this_manip_space, phi = pi/3, theta = pi/4)
```

For illustration plot the projection of the data onto this new `r_space` and plot the xy contributions. Do this several times while varying the magnitude of of `phi` an angle controlling the magnitude of manipulation of the `manip_var`. At a constant `theta` angle of rotation in coordinate space.

```{r}
#knitr doesn't like par(mfrow), maybe ggplot2 has alternative?
for (i in seq(1/5*pi, 2/5*pi, pi/20)) {
  this_r_space <- horizontal_manip(manip_space = this_manip_space, phi = i, theta = 1/3*pi)
  proj <- data_proj(data = data, r_space = this_r_space)
  plot(proj[,1], proj[,2], main="Projected data")
  Sys.sleep(time=.5)
  print(i)
}
```

# Example 2 - Climate glyph map


```{r}
library(GGally)
?GGally::glyphs #see example
 nasaLate <- nasa[
   nasa$date >= as.POSIXct("1998-01-01") &
   nasa$lat >= 20 &
   nasa$lat <= 40 &
   nasa$long >= -80 &
   nasa$long <= -60
 , ]
 temp.gly <- glyphs(nasaLate, "long", "day", "lat", "surftemp", height=2.5)
 ggplot2::ggplot(temp.gly, ggplot2::aes(gx, gy, group = gid)) +
   add_ref_lines(temp.gly, color = "grey90") +
   add_ref_boxes(temp.gly, color = "grey90") +
   ggplot2::geom_path() +
   ggplot2::theme_bw() +
   ggplot2::labs(x = "", y = "")
```

# Example 3 - Tour manipulation

```{r}
library(tourr)

data <- flea[,1:6]
p <- ncol(data)
col <- rainbow(length(unique(flea$species)))[as.numeric(as.factor(flea$species))]
pch <- as.numeric(flea$species)+14

holes <- save_history(data, guided_tour(index = holes), max_bases = 15)
holes_end <- matrix(as.numeric(holes[,,dim(holes)[3]]),ncol=2)

m_sp <- create_manip_space(basis = holes_end, manip_var = 3)



```

# Summary

[RECAP WHAT PKG HELPS US DO, nanier for example:]
The tools in `naniar` help us identify where missingness is, while maintaining a tidy workflow. We care about these mechanisms or these patterns because they can help us understand potential mechanisms, such as equipment failures, and then identify possible solutions based upon this evidence.

# Future development

[further integration with tourr needed?]

# Thank you

Formost, thanks to Di Cook for direction, inspiration, and the ground work underpinning this work. Her ability for conceptualizing higher dimensions and visualizing data in general is unparallel.
Thanks to Ursla Laa for use cases and prompts to keep me focused.

# References
<!-- Monash prefers APA -->
<!-- citation(package = "tourr") -->
<!-- citation(package = "GGally") -->

- Cook, D., & Buja, A. (1997). Manual Controls for High-Dimensional Data Projections. Journal of Computational and Graphical Statistics, 6(4), 464–480. https://doi.org/10.2307/1390747
- Wickham, H., Cook, D., & Hofmann, H. (2015). Visualizing statistical models: Removing the blindfold: Visualizing Statistical Models. Statistical Analysis and Data Mining: The ASA Data Science Journal, 8(4), 203–225. https://doi.org/10.1002/sam.11271
- Dianne Cook and Hadley Wickham (NA). tourr: Implement Tour Methods in R Code. Rpackage version 0.5.5.9000. https://github.com/ggobi/tourr
- Barret Schloerke, Jason Crowley, Di Cook, Francois Briatte, Moritz Marbach,
Edwin Thoen, Amos Elberg and Joseph Larmarange (2017). GGally: Extension to
'ggplot2'. R package version 1.3.2. https://CRAN.R-project.org/package=GGally


